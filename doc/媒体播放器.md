è¿™æ˜¯ä¸€ä¸ª**éå¸¸å…¸å‹ã€è€Œä¸”ä½ è¿™ä¸ªåœºæ™¯ä¸‹å¿…ç„¶ä¼šé‡åˆ°çš„é—®é¢˜**ã€‚
å…ˆç»™ä½ **ç»“è®º**ï¼Œå†ç»™ä½ **å¯è½åœ°çš„æ”¹æ³•**ã€‚

------

## ä¸€ã€é—®é¢˜æœ¬è´¨ï¼ˆä¸ºä»€ä¹ˆä¼šæŠ¥è¯ä¹¦åå•†é”™è¯¯ï¼‰

ä½ ç°åœ¨æ˜¯ï¼š

```kotlin
setDataSource(context, Uri.parse(url), headers, null)
```

ğŸ‘‰ **MediaPlayer / MediaExtractor åœ¨å†…éƒ¨è‡ªå·±èµ° HTTPS**

ä½†ä½ çš„æœåŠ¡å™¨æ˜¯ï¼š

- **è‡ªç­¾åè¯ä¹¦**
- æˆ– **ç§æœ‰ CA**
- æˆ– **è¯ä¹¦é“¾ä¸å®Œæ•´**

âŒ **Android ç³»ç»Ÿé»˜è®¤åªä¿¡ä»»ç³»ç»Ÿ CA**
ğŸ‘‰ æ‰€ä»¥ **TLS æ¡æ‰‹ç›´æ¥å¤±è´¥**

------

## äºŒã€âŒ é”™è¯¯çš„è§£å†³æ–¹å‘ï¼ˆå…ˆå¸®ä½ æ’é›·ï¼‰

ä¸‹é¢è¿™äº› **éƒ½è§£å†³ä¸äº† MediaPlayer çš„é—®é¢˜**ï¼š

- âŒ OkHttp å¿½ç•¥è¯ä¹¦ï¼ˆMediaPlayer ä¸ç”¨ OkHttpï¼‰
- âŒ åœ¨ headers é‡ŒåŠ  token
- âŒ TrustManager å†™åœ¨åˆ«çš„åœ°æ–¹

ğŸ‘‰ **MediaPlayer ä¸ä¼šç”¨ä½ çš„ç½‘ç»œæ ˆ**

------

## ä¸‰ã€âœ… æ­£ç¡® & æ¨èçš„è§£å†³æ–¹æ¡ˆï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰

------

## âœ… æ–¹æ¡ˆä¸€ï¼ˆæœ€æ¨èï¼‰ï¼šNetwork Security Configï¼ˆå®˜æ–¹æ­£è§£ï¼‰

è¿™æ˜¯ **Android 7.0+ å®˜æ–¹æ”¯æŒæ–¹å¼**
âœ” æ”¯æŒ MediaPlayer
âœ” æ”¯æŒè‡ªç­¾å / ç§æœ‰ CA
âœ” ä¸ç”¨æ”¹ä¸šåŠ¡ä»£ç 

------

### 1ï¸âƒ£ æŠŠä½ çš„æœåŠ¡å™¨è¯ä¹¦ï¼ˆæˆ– CAï¼‰æ”¾è¿›é¡¹ç›®

ä¾‹å¦‚ï¼š

```
app/src/main/res/raw/my_ca.crt
```

> æ³¨æ„ï¼š
>
> - å¦‚æœä½ æ˜¯è‡ªç­¾åè¯ä¹¦ â†’ æ”¾è¯ä¹¦æœ¬èº«
> - å¦‚æœæ˜¯ç§æœ‰ CA â†’ æ”¾ CA è¯ä¹¦

------

### 2ï¸âƒ£ æ–°å»º `res/xml/network_security_config.xml`

```xml
<?xml version="1.0" encoding="utf-8"?>
<network-security-config>

    <domain-config cleartextTrafficPermitted="false">
        <domain includeSubdomains="true">your.domain.com</domain>

        <trust-anchors>
            <!-- ç³»ç»Ÿ CA -->
            <certificates src="system" />
            <!-- ä½ çš„ç§æœ‰è¯ä¹¦ / CA -->
            <certificates src="@raw/my_ca" />
        </trust-anchors>
    </domain-config>

</network-security-config>
```

------

### 3ï¸âƒ£ åœ¨ `AndroidManifest.xml` ä¸­å¯ç”¨

```xml
<application
    android:networkSecurityConfig="@xml/network_security_config"
    android:usesCleartextTraffic="false"
    ... >
```

âœ… **MediaPlayer / setDataSource ä¼šè‡ªåŠ¨ä¿¡ä»»ä½ çš„è¯ä¹¦**

ğŸ“Œ **è¿™æ˜¯çº¿ä¸Šå¯ç”¨ã€æœ€ç¨³çš„æ–¹æ¡ˆ**

------

## å››ã€âœ… æ–¹æ¡ˆäºŒï¼šå…ˆä¸‹è½½ï¼Œå†æœ¬åœ°æ’­æ”¾ï¼ˆIM é¡¹ç›®æœ€å¸¸ç”¨ï¼‰

> **èŠå¤©è¯­éŸ³ / è§†é¢‘ å¼ºçƒˆæ¨èè¿™ç§æ–¹å¼**

### æ€è·¯

```
HTTPS ä¸‹è½½ï¼ˆä½ æ§åˆ¶è¯ä¹¦ï¼‰
â†“
ä¿å­˜ä¸ºæœ¬åœ°æ–‡ä»¶
â†“
MediaPlayer æ’­æ”¾æœ¬åœ°æ–‡ä»¶
```

âœ” å®Œå…¨ç»•è¿‡ MediaPlayer çš„ TLS
âœ” æ”¯æŒæ–­ç‚¹ / ç¼“å­˜
âœ” èŠå¤©åœºæ™¯ä½“éªŒæœ€å¥½

------

### ç¤ºä¾‹ï¼ˆæ ¸å¿ƒæ€è·¯ï¼‰

```kotlin
// ç”¨ OkHttp / ä½ å·²æœ‰çš„ç½‘ç»œæ ˆä¸‹è½½
val file = downloadToCache(url)

// æœ¬åœ°æ’­æ”¾
mediaPlayer.setDataSource(file.absolutePath)
mediaPlayer.prepareAsync()
```

ğŸ‘‰ **å¾®ä¿¡ / QQ éƒ½æ˜¯è¿™ä¹ˆå¹²çš„**

------

## äº”ã€âŒ ä¸æ¨èä½†è¯´æ˜ä¸€ä¸‹ï¼šåå°„ / Hack SSL

- åå°„æ›¿æ¢ MediaPlayer SSL
- Hook TrustManager

âŒ Android P+ åŸºæœ¬ä¸å¯ç”¨
âŒ ä¸Šçº¿å®¡æ ¸é£é™©å¤§
âŒ æä¸ç¨³å®š

------

## å…­ã€ä½ è¿™ä¸ªä»£ç è¯¥æ€ä¹ˆâ€œæœ€å°æ”¹åŠ¨â€ï¼Ÿ

### å¦‚æœä½ é€‰ **æ–¹æ¡ˆä¸€ï¼ˆæ¨èï¼‰**

ğŸ‘‰ **ä½ çš„ä»£ç ä¸€è¡Œéƒ½ä¸ç”¨æ”¹**

```kotlin
setDataSource(mActivity!!, Uri.parse(url), headers, null)
```

è¯ä¹¦ä¸€æ—¦é…å¥½ï¼Œç›´æ¥èƒ½æ’­ã€‚

------

### å¦‚æœä½ é€‰ **æ–¹æ¡ˆäºŒï¼ˆIM æ¨èï¼‰**

```kotlin
if (valRef is String) {
    downloadThenPlay(valRef)
}
```

------

## ä¸ƒã€ç»™ä½ ä¸€ä¸ªæ˜ç¡®çš„å»ºè®®ï¼ˆç»“åˆä½ ä¹‹å‰ IM / è¯­éŸ³é€»è¾‘ï¼‰

> ğŸ”¥ **å¼ºçƒˆå»ºè®®ä½ ï¼š**
>
> - è¯­éŸ³ / è§†é¢‘
> - **æ°¸è¿œå…ˆä¸‹è½½åˆ°æœ¬åœ°**
> - å†ç”¨ MediaPlayer æ’­æ”¾

åŸå› ï¼š

- è¯ä¹¦é—®é¢˜ä¸€æ¬¡è§£å†³
- æ”¯æŒç¼“å­˜
- æ”¯æŒæ–­ç‚¹
- æ”¯æŒå¼±ç½‘

------

## å…«ã€æˆ‘å¯ä»¥ç»§ç»­ç›´æ¥å¸®ä½ åšçš„äº‹

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥ç›´æ¥ç»™ä½ ï¼š

1ï¸âƒ£ **æ”¯æŒè‡ªç­¾åè¯ä¹¦çš„ OkHttp ä¸‹è½½å™¨**
2ï¸âƒ£ **è¯­éŸ³ç¼“å­˜ç®¡ç†å™¨ï¼ˆLRU / size limitï¼‰**
3ï¸âƒ£ **AudioPlayer å°è£…ï¼ˆURL / File / ByteArray ä¸‰åˆä¸€ï¼‰**

ä½ ç›´æ¥è¯´ä¸€å¥ï¼š
ğŸ‘‰ **â€œæŒ‰ IM è¯­éŸ³æ’­æ”¾å™¨å¸®æˆ‘å°è£…â€**





è¿™ä¸ªé—®é¢˜é—®å¾—**éå¸¸å…³é”®**ï¼Œè€Œä¸”ä½ ç°åœ¨è¿™ä¸ª**è‡ªç­¾åè¯ä¹¦ + Android æ’­æ”¾éŸ³é¢‘**çš„åœºæ™¯é‡Œï¼Œ**90% çš„å‘éƒ½åœ¨è¿™é‡Œ**ã€‚
æˆ‘ç›´æ¥ç»™ä½ ä¸€ä¸ª**æ¸…æ™°ã€å¯æ“ä½œçš„ç»“è®º**ã€‚

------

## ä¸€å¥è¯ç»“è®ºï¼ˆå…ˆè®°ä½è¿™ä¸ªï¼‰

> **my_ca.crt æ”¾çš„æ˜¯ã€Œç­¾å‘è€…ï¼ˆCAï¼‰ã€è¯ä¹¦**
> **cert.pem é€šå¸¸æ˜¯ã€ŒæœåŠ¡å™¨è¯ä¹¦ã€æœ¬èº«**

ä¸¤è€… **ä¸æ˜¯ä¸€å›äº‹ï¼Œä¹Ÿä¸èƒ½éšä¾¿äº’æ¢**ã€‚

------

## äºŒã€è¯ä¹¦é“¾æ˜¯æ€ä¹ˆä¸€å›äº‹ï¼ˆéå¸¸é‡è¦ï¼‰

HTTPS ç”¨çš„æ˜¯ **è¯ä¹¦é“¾**ï¼š

```
[ Root CA ]
    â†“
[ Intermediate CA ]
    â†“
[ Server Certificate ]  â† ä½ çš„æœåŠ¡å™¨ cert.pem
```

Android ä¿¡ä»»çš„æ˜¯ï¼š

- ç³»ç»Ÿ Root CA
- æˆ–ä½  **æ˜¾å¼åŠ å…¥çš„ CA**

âŒ **ä¸ä¼šç›´æ¥ä¿¡ä»»æœåŠ¡å™¨è¯ä¹¦**

------

## ä¸‰ã€`cert.pem` æ˜¯ä»€ä¹ˆï¼Ÿ

### ä¸€èˆ¬æƒ…å†µä¸‹

```text
cert.pem
```

ğŸ‘‰ æ˜¯ **æœåŠ¡å™¨è¯ä¹¦**ï¼ˆleaf certificateï¼‰

ç‰¹ç‚¹ï¼š

- åŒ…å«åŸŸåï¼ˆCN / SANï¼‰
- æœ‰æœ‰æ•ˆæœŸ
- **ç”±æŸä¸ª CA ç­¾åï¼ˆå“ªæ€•æ˜¯è‡ªç­¾åï¼‰**
- ç”¨åœ¨ **Nginx / Apache / Tomcat**

ğŸ“Œ å¸¸è§é…ç½®ï¼š

```nginx
ssl_certificate     cert.pem;
ssl_certificate_key key.pem;
```

------

## å››ã€`my_ca.crt` åº”è¯¥æ˜¯ä»€ä¹ˆï¼Ÿ

### æ­£ç¡®å«ä¹‰

```text
my_ca.crt
```

ğŸ‘‰ **CA è¯ä¹¦ï¼ˆRoot æˆ– Intermediateï¼‰**

ç‰¹ç‚¹ï¼š

- `Basic Constraints: CA:TRUE`
- ç”¨æ¥ **ç­¾å‘æœåŠ¡å™¨è¯ä¹¦**
- **å¯ä»¥ä¿¡ä»»å¤šä¸ªæœåŠ¡å™¨è¯ä¹¦**

ğŸ“Œ æ”¾è¿› Android çš„ï¼š

```xml
<certificates src="@raw/my_ca" />
```

------

## äº”ã€ä¸‰ç§å¸¸è§åœºæ™¯ï¼ˆä½ å¯¹ç…§ä¸€ä¸‹ï¼‰

------

### âœ… åœºæ™¯ 1ï¼šä½ ç”¨çš„æ˜¯ã€Œè‡ªå»º CAã€ï¼ˆæœ€è§„èŒƒï¼‰

```
my_root_ca.crt
      â†“
server_cert.pem
```

ğŸ‘‰ Androidï¼š

```xml
<certificates src="@raw/my_root_ca" />
```

ğŸ‘‰ **ä¸è¦æ”¾ server_cert.pem**

------

### âš ï¸ åœºæ™¯ 2ï¼šä½ ç”¨çš„æ˜¯ã€Œè‡ªç­¾åæœåŠ¡å™¨è¯ä¹¦ã€ï¼ˆæœ€å¸¸è§ï¼‰

```
server_cert.pem
(è‡ªç­¾å)
```

è¿™ç§æƒ…å†µä¸‹ï¼š

- **cert.pem æ—¢æ˜¯æœåŠ¡å™¨è¯ä¹¦ï¼Œä¹Ÿæ˜¯ CA**
- `CA:TRUE`

ğŸ‘‰ å¯ä»¥ **ç›´æ¥é‡å‘½åæˆ my_ca.crt ä½¿ç”¨**

```xml
<certificates src="@raw/my_ca" />
```

ğŸ“Œ ä½†å‰ææ˜¯ï¼š

> è¿™ä¸ªè¯ä¹¦ **ç¡®å®æ˜¯ CA:TRUE**

------

### âŒ åœºæ™¯ 3ï¼šä½ ç›´æ¥æŠŠã€Œæ™®é€šæœåŠ¡å™¨è¯ä¹¦ã€å½“ CAï¼ˆé”™è¯¯ï¼‰

å¦‚æœä½ çš„ `cert.pem`ï¼š

- `CA:FALSE`
- æ²¡æœ‰ `Basic Constraints`

âŒ Android **ä¸ä¼šä¿¡ä»»**
âŒ TLS æ¡æ‰‹ä¾ç„¶å¤±è´¥

------

## å…­ã€å¦‚ä½•å¿«é€Ÿåˆ¤æ–­ä½ çš„ `cert.pem` èƒ½ä¸èƒ½ç”¨ï¼Ÿ

åœ¨æœåŠ¡å™¨æˆ–æœ¬åœ°æ‰§è¡Œï¼š

```bash
openssl x509 -in cert.pem -noout -text
```

é‡ç‚¹çœ‹è¿™ä¸€è¡Œï¼š

```text
Basic Constraints: CA:TRUE
```

| ç»“æœ            | èƒ½ä¸èƒ½å½“ my_ca.crt |
| --------------- | ------------------ |
| CA:TRUE         | âœ… å¯ä»¥             |
| CA:FALSE / æ²¡æœ‰ | âŒ ä¸è¡Œ             |

------

## ä¸ƒã€ä½ ç°åœ¨æœ€å¯èƒ½æ˜¯å“ªç§ï¼Ÿ

ç»“åˆä½ è¯´çš„ï¼š

> â€œæœåŠ¡å™¨ç”¨çš„æ˜¯è‡ªå·±è¯ä¹¦â€

**90% æƒ…å†µæ˜¯ï¼š**

- ç”¨ `openssl req -x509 ...`
- ç”Ÿæˆçš„ **è‡ªç­¾åè¯ä¹¦**
- **CA:TRUE**

ğŸ‘‰ **ä½ å¯ä»¥ç›´æ¥ç”¨å®ƒå½“ my_ca.crt**

------

## å…«ã€Android æ­£ç¡®ä½¿ç”¨å§¿åŠ¿ï¼ˆæœ€ç»ˆç‰ˆï¼‰

```xml
<trust-anchors>
    <certificates src="system" />
    <certificates src="@raw/my_ca" />
</trust-anchors>
```

ğŸ“Œ å…¶ä¸­ï¼š

```
my_ca.crt = ä½ çš„ CA / è‡ªç­¾åè¯ä¹¦
```

------

## ä¹ã€ç»™ä½ ä¸€ä¸ªâ€œç»ä¸ç¿»è½¦â€çš„å»ºè®®

> ğŸ”¥ **ä¸è¦ç”¨æœåŠ¡å™¨è¯ä¹¦å»â€œå†’å…… CAâ€**
> ğŸ”¥ **ä¸€å®šç¡®è®¤ CA:TRUE**

------

## åã€æˆ‘å¯ä»¥ä¸‹ä¸€æ­¥ç›´æ¥å¸®ä½ åšçš„äº‹

å¦‚æœä½ æ„¿æ„ï¼Œä½ å¯ä»¥ç›´æ¥è´´å‡ºï¼š

- `openssl x509 -text` çš„è¾“å‡ºï¼ˆåˆ æ‰ç§å¯†ä¿¡æ¯ï¼‰
- æˆ–å‘Šè¯‰æˆ‘ä½ è¯ä¹¦æ˜¯æ€ä¹ˆç”Ÿæˆçš„

æˆ‘å¯ä»¥ç›´æ¥å‘Šè¯‰ä½ ä¸€å¥è¯ï¼š

> **â€œè¿™ä¸ª cert.pem èƒ½ä¸èƒ½å½“ my_ca.crt ç”¨â€**

ä¸ä¼šè®©ä½ èµ°å¼¯è·¯ã€‚





å¾ˆå¥½ï¼Œè¿™ä¸ªè¯ä¹¦ä½ ä¸€è´´å‡ºæ¥ï¼Œ**ç­”æ¡ˆå…¶å®å·²ç»éå¸¸æ˜ç¡®äº†**ã€‚
æˆ‘ç›´æ¥ç»™ä½ **ç»“è®º + è¯æ® + ä½ è¯¥æ€ä¹ˆåš**ã€‚

------

## âœ… ç»“è®ºï¼ˆä¸€å¥è¯ï¼‰

> **è¿™ä¸ª cert.pem ä¸æ˜¯ CA è¯ä¹¦ï¼Œä¸èƒ½å½“ my_ca.crt ç”¨ã€‚**

å¦‚æœä½ æŠŠå®ƒæ”¾è¿› `network_security_config` é‡Œï¼š

```xml
<certificates src="@raw/my_ca" />
```

ğŸ‘‰ **TLS ä»ç„¶ä¼šå¤±è´¥**ï¼ˆå’Œä½ ç°åœ¨çš„ç°è±¡ä¸€è‡´ï¼‰ã€‚

------

## ğŸ” ä¸ºä»€ä¹ˆæˆ‘èƒ½è¿™ä¹ˆç¡®å®šï¼Ÿï¼ˆå…³é”®è¯æ®ï¼‰

çœ‹ä½ è¯ä¹¦é‡Œçš„è¿™å‡ æ®µï¼ˆæˆ‘å¸®ä½ ç¿»è¯‘æˆâ€œäººè¯â€ï¼‰ï¼š

### 1ï¸âƒ£ `Basic Constraints`

```text
X509v3 Basic Constraints:
    CA:FALSE
```

åœ¨ä½ çš„ PEM é‡Œå¯¹åº”çš„æ˜¯ï¼š

```text
MBAGA1UdEwEB/wQCMAAw
```

ğŸ‘‰ **CA:FALSE = æ˜ç¡®å£°æ˜ï¼šæˆ‘ä¸æ˜¯ CA**

------

### 2ï¸âƒ£ è¿™æ˜¯ä¸€ä¸ªã€ŒæœåŠ¡å™¨è¯ä¹¦ï¼ˆleaf certï¼‰ã€

ä»å†…å®¹å¯ä»¥åˆ¤æ–­ï¼š

- æœ‰ `Subject Alternative Name`ï¼š

  ```text
  bird2fish.com
  ```

- æœ‰ `Extended Key Usage`ï¼š

  ```text
  TLS Web Server Authentication
  ```

- **æ²¡æœ‰ CA æƒé™**

âœ” è¿™æ˜¯ **æ ‡å‡† HTTPS æœåŠ¡å™¨è¯ä¹¦**

------

### 3ï¸âƒ£ è¯ä¹¦æœ‰æ•ˆæœŸåªæœ‰ 1 å¹´

```text
2023-11-14 â†’ 2024-11-13
```

ğŸ‘‰ è¿™ä¹Ÿæ˜¯æœåŠ¡å™¨è¯ä¹¦çš„å…¸å‹ç‰¹å¾
ï¼ˆCA é€šå¸¸ 5ï½20 å¹´ï¼‰

------

## ğŸš« ä½ ç°åœ¨ä¸ºä»€ä¹ˆä¼šâ€œåå•†è¯ä¹¦é”™è¯¯â€

å› ä¸ºä½ ç°åœ¨çš„é“¾è·¯æ˜¯ï¼š

```
Android
  â†“
æ”¶åˆ° server cert.pem
  â†“
å‘ç°ï¼š
  - ä¸æ˜¯ç³»ç»Ÿ CA
  - ä¹Ÿä¸æ˜¯ä½ ä¿¡ä»»çš„ CA
  - CA:FALSE
  â†“
âŒ TLS æ¡æ‰‹å¤±è´¥
```

**å®Œå…¨ç¬¦åˆä½ ç°åœ¨çš„ç°è±¡ã€‚**

------

## âœ… æ­£ç¡®çš„è§£å†³æ–¹æ¡ˆï¼ˆç»™ä½  3 æ¡è·¯ï¼ŒæŒ‰æ¨èåº¦ï¼‰

------

## ğŸ¥‡ æ–¹æ¡ˆä¸€ï¼ˆæœ€æ­£è§„ã€æœ€æ¨èï¼‰ï¼šç”Ÿæˆä¸€ä¸ªçœŸæ­£çš„ CA

### 1ï¸âƒ£ ç”Ÿæˆ Root CA

```bash
openssl genrsa -out my_root_ca.key 4096

openssl req -x509 -new -nodes \
  -key my_root_ca.key \
  -sha256 -days 3650 \
  -out my_root_ca.crt
```

> è¿™ä¸ªè¯ä¹¦ **CA:TRUE**

------

### 2ï¸âƒ£ ç”¨è¿™ä¸ª CA ç­¾ä½ çš„æœåŠ¡å™¨è¯ä¹¦

```bash
openssl genrsa -out server.key 2048
openssl req -new -key server.key -out server.csr

openssl x509 -req \
  -in server.csr \
  -CA my_root_ca.crt \
  -CAkey my_root_ca.key \
  -CAcreateserial \
  -out server_cert.pem \
  -days 365 -sha256
```

------

### 3ï¸âƒ£ Android ç«¯

```xml
<certificates src="@raw/my_root_ca" />
```

âœ” **MediaPlayer / HTTPS å…¨éƒ¨é€šè¿‡**

------

## ğŸ¥ˆ æ–¹æ¡ˆäºŒï¼ˆæœ€çœäº‹ï¼‰ï¼šå…ˆä¸‹è½½ï¼Œå†æœ¬åœ°æ’­æ”¾ï¼ˆIM å¼ºçƒˆæ¨èï¼‰

ä½ å·²ç»åœ¨åš IM / è¯­éŸ³ï¼š

```text
HTTPS ä¸‹è½½ï¼ˆOkHttpï¼Œå¿½ç•¥è¯ä¹¦ï¼‰
â†“
ä¿å­˜æœ¬åœ°
â†“
MediaPlayer æ’­æ”¾æœ¬åœ°
```

âœ” ä¸éœ€è¦ network_security_config
âœ” ä¸ç¢° MediaPlayer çš„ TLS
âœ” å¾®ä¿¡ä¸Šçº¿çº§æ–¹æ¡ˆ

------

## ğŸ¥‰ æ–¹æ¡ˆä¸‰ï¼ˆä¸´æ—¶ / ä¸æ¨èï¼‰ï¼šé‡æ–°ç”Ÿæˆâ€œè‡ªç­¾å CA:TRUEâ€çš„è¯ä¹¦

å¦‚æœä½ ç°åœ¨æ˜¯ç”¨ç±»ä¼¼ï¼š

```bash
openssl req -x509 ...
```

ğŸ‘‰ ä½†**æ²¡åŠ  CA æ‰©å±•**

å¯ä»¥è¿™æ ·ç”Ÿæˆï¼š

```bash
openssl req -x509 -new -nodes -key server.key \
  -sha256 -days 365 \
  -out my_ca.crt \
  -extensions v3_ca
```

å¹¶ç¡®ä¿ï¼š

```text
Basic Constraints: CA:TRUE
```

------

## ğŸ“Œ æœ€é‡è¦çš„æ€»ç»“ï¼ˆè¯·è®°ä½è¿™å¥ï¼‰

> â— **Android ä¿¡ä»»çš„æ˜¯ CAï¼Œä¸æ˜¯æœåŠ¡å™¨è¯ä¹¦**
> â— **CA:FALSE çš„ cert.pem æ°¸è¿œä¸èƒ½æ”¾è¿› trust-anchors**

------

## ğŸ‘‰ ç»™ä½ ä¸€ä¸ªâ€œä¸‹ä¸€æ­¥å»ºè®®â€

ç»“åˆä½ å‰é¢è¯´çš„ **IM / è¯­éŸ³ / MP4 / MediaPlayer**ï¼Œ
**æˆ‘å¼ºçƒˆå»ºè®®ä½ ç›´æ¥é€‰ï¼š**

> ğŸ”¥ **æ–¹æ¡ˆäºŒï¼šä¸‹è½½ â†’ æœ¬åœ°æ’­æ”¾**

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥ç›´æ¥å¸®ä½ å†™ä¸€ä¸ªï¼š

- âœ… æ”¯æŒè‡ªç­¾åè¯ä¹¦çš„ OkHttpClient
- âœ… è¯­éŸ³æ–‡ä»¶ç¼“å­˜ï¼ˆæŒ‰ URL hashï¼‰
- âœ… è‡ªåŠ¨å¤ç”¨æœ¬åœ°æ–‡ä»¶

ä½ åªè¦ä¸€å¥è¯ï¼š
ğŸ‘‰ **â€œç»™æˆ‘ IM è¯­éŸ³ä¸‹è½½ + æ’­æ”¾å®Œæ•´å°è£…â€**